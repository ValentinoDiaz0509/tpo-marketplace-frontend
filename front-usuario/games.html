<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo de juegos</title>
  <script src="cart.js"></script>
  <script>
    const API_URL = "http://localhost:4002";

    document.addEventListener("DOMContentLoaded", async () => {
      const searchForm = document.getElementById("searchForm");
      const filterForm = document.getElementById("filterForm");
      const container = document.getElementById("gamesContainer");

      // Cargar todos los juegos al iniciar
      loadAllGames();

      // busqued por nombre
      searchForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const title = document.getElementById("searchTitle").value;
        const res = await fetch(`${API_URL}/games/nombre?title=${title}`);
        const games = await res.json();
        renderGames(games);
      });

      //  filtrar por precio
      filterForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const min = document.getElementById("minPrice").value;
        const max = document.getElementById("maxPrice").value;
        const res = await fetch(`${API_URL}/games/precio?rangoMin=${min}&rangoMax=${max}`);
        const games = await res.json();
        renderGames(games);
      });

      // carga  los juegos
      async function loadAllGames() {
        const res = await fetch(`${API_URL}/games`);
        const games = await res.json();
        renderGames(games);
      }

      // renderiza juegos en pantalla
      function renderGames(games) {
        container.innerHTML = "";
        if (games.length === 0) {
          container.textContent = "No se encontraron juegos.";
          return;
        }

        const msg = document.createElement("p");
        msg.id = "cartMsg";
        container.appendChild(msg);

        games.forEach(g => {
          const div = document.createElement("div");
          div.innerHTML = `
            <hr>
            <a href="game-details.html?id=${g.id}">
              <b>${g.title}</b>
            </a> — $${g.price}<br>
            Plataforma: ${g.platform} | Stock: ${g.stock}<br>
            <a href="game-details.html?id=${g.id}">
              <img src="${g.imageUrl}" width="120" alt="${g.title}">
            </a><br>
            <button onclick="addToCart(${g.id}, '${g.title}', ${g.price}); 
              document.getElementById('cartMsg').textContent='${g.title} agregado al carrito 🛒';">
              Agregar al carrito 🛒
            </button>
          `;
          container.appendChild(div);
        });
      }
    });
  </script>
</head>
<body>
  <h2>🎮 Catálogo de juegos</h2>

  <form id="searchForm">
    <input type="text" id="searchTitle" placeholder="Buscar por nombre">
    <button type="submit">Buscar</button>
  </form>

  <form id="filterForm">
    <input type="number" id="minPrice" placeholder="Precio mínimo">
    <input type="number" id="maxPrice" placeholder="Precio máximo">
    <button type="submit">Filtrar</button>
  </form>

  <button onclick="window.location.href='cart.html'">🛍️ Ver carrito</button>

  <div id="gamesContainer">Cargando juegos...</div>
</body>
</html>
